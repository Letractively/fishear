<html 
	t:type="layout" 
	t:title="Database Audit"
	t:loginRequired="false"
	xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter"
>

	<t:form t:id="search">
		<table>
		<tr>
		<td><label>Entity:</label></td>
		<td>
			<t:select t:model="Entities" value="entityHash" onchange="form.submit(); " />
			<label>&#160;ObjID:</label>
			<t:textfield t:id="selectedObjectId" size="8" t:mixins="jquery/Autocomplete" />
			<label>&#160;Changed:</label><t:datefield t:id="changedFrom" size="7"/>-<t:datefield t:id="changedTo" size="7"/>
		</td>
		<td></td>
		</tr>
		<tr>
		<td><label>Action:</label></td>
		<td>
			<t:select t:model="Actions" value="selectedAction" onchange="form.submit(); " />
			<label>&#160;Property:</label><t:select t:model="AvailableProperies" t:value="selectedProperty" onchange="form.submit(); " style="min-width:150px;" />
			<label>&#160;Contains:</label><t:textfield t:id="searchpropertyValue" size="14"/>
		</td>
		<td>
			<t:submit value="Search"/>
			&#160; <t:eventlink t:event="clearSearch">Clear Search</t:eventlink>
		</td>
		</tr>
		</table>
	</t:form>
	
	<t:if t:test="entityHash">
		<t:grid 
			t:source="Audits"
			t:row="row"
			include="action,actionDate,actionUser,objectId,changeNumber"
			add="auditedEntity,detail"
			reorder="auditedEntity,action,actionDate,actionUser,objectId,changeNumber,detail"
		>
		<p:auditedEntityCell>${getEntityShortName(row.auditedEntity)}</p:auditedEntityCell>
		<p:detailCell><t:eventlink t:event="detail" t:context="row.id" >Detail</t:eventlink></p:detailCell>
		</t:grid>
	<p:else>
		<h2>Please select an entity first</h2>
	</p:else>
	</t:if>

	<t:if t:test="detail">
		<t:component t:id="auditDetail" />
	</t:if>
	
</html>
